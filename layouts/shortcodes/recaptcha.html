<div id='{{ .Get "recaptcha-id" | default "my-custom-recaptcha" }}'></div>

<script>
  (function() {
    var recaptchaId = '{{ .Get "recaptcha-id" | default "my-custom-recaptcha" }}';
    var siteKey = '{{ .Site.Params.recaptchaSiteKey }}';
    var theme = '{{ .Get "theme" | default "light" }}';
    var recaptchaLoaded = false;

    window.onloadCallback = function() {
      if (document.getElementById(recaptchaId)) {
        grecaptcha.render(recaptchaId, {
          sitekey: siteKey,
          theme: theme
        });
      }
    };

    function loadRecaptcha() {
      if (recaptchaLoaded) return;
      recaptchaLoaded = true;

      var script = document.createElement('script');
      script.src = 'https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit&hl={{ .Page.Lang }}';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    }

    // Load reCAPTCHA when user interacts with form
    var form = document.getElementById(recaptchaId).closest('form');
    if (form) {
      var inputs = form.querySelectorAll('input, textarea, select');
      inputs.forEach(function(input) {
        input.addEventListener('focus', loadRecaptcha, { once: true });
      });
    }
  })();
</script>
